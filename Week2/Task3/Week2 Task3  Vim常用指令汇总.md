# Week2 Task3  Vim常用指令汇总

参考: https://github.com/wsdjeg/vim-galore-zh_cn



## Vim模式及切换

- **正常模式(Normal mode):** 启动时默认进入该模式，可用`Esc`切换至该模式。

- **插入模式(Insert mode):** 可编辑文本。

  - `i`：在当前光标位置插入。
  - `I`：在行首插入。
  - `a`：在光标后插入（append）。
  - `A`：在行尾插入。
  - `o`：在当前行下方新开一行并进入插入模式。
  - `O`：在当前行上方新开一行并进入插入模式。

- **可视模式(Visual mode):** 用于选择文本，之后可以对选中的文本进行操作，如复制、删除等。

  - `v`：字符级别的选择。
  - `V`：行级别的选择。
  - `Ctrl-v`：块级别的选择（矩形区域）。

- **命令模式(Command mode):** 输入以冒号开头的命令，如搜索、替换、保存、退出等。

  按 `:` 进入命令行模式。

  

## Vim 文件

| 文件操作           | 说明                                 |
| ------------------ | ------------------------------------ |
| `vim <filename>`   | 打开文件                             |
| `:w`/`:write`      | 保存文件                             |
| `:up`/`:update`    | 如果文件有修改，则保存               |
| `:sav newfilename` | 另存为                               |
| `:w!`              | 强制保存                             |
| `:set undofile`    | 撤销文件                             |
| `:bd`              | 关闭当前缓冲区（文件），但不退出 Vim |
| `:x`               | 保存并退出，如果文件没有更改，只退出 |
| `ls`               | 列出所有打开的文件                   |
| `:n`               | 切换到下一个文件                     |
| `:N`               | 切换到上一个文件                     |
| `:fir`             | 切换到第一个文件                     |
| `:la`              | 切换到下一个文件                     |
| `vg_`              | 选中当前行至结尾                     |
| `/<content>`       | 向前搜索内容                         |
| `?<content>`       | 向后搜索内容                         |
| `n`                | 重复上次搜索，继续查找下一个匹配项   |
| `N`                | 反向重复上次搜索                     |
| `:s/old/new/`      | 替换当前行中的第一次出现             |
| `:s/old/new/g`     | 替换当前行中的所有出现               |
| `:%s/old/new/g`    | 替换整个文件中的所有出现             |
| `:%s/old/new/gc`   | 替换整个文件中的所有出现，并逐个确认 |
| `:Ex`              | 打开当前目录的文件浏览器             |



## Vim参数列表

| 参数列表操作                          | 说明                 |
| ------------------------------------- | -------------------- |
| :arglocal                             | 创建参数列表         |
| :args                                 | 查看参数列表         |
| :next, :previous, :first, :last       | 切换参数列表中的文件 |
| :argadd, :argdelete, :args <filename> | 改变参数列表         |
| :argdo                                | 批处理               |



## 按键映射

| 递归    | 非递归      | 模式                             |
| ------- | ----------- | -------------------------------- |
| `:map`  | `:noremap`  | normal, visual, operator-pending |
| `:nmap` | `:nnoremap` | normal                           |
| `:xmap` | `:xnoremap` | visual                           |
| `:cmap` | `:cnoremap` | command-line                     |
| `:omap` | `:onoremap` | operator-pending                 |
| `:imap` | `:inoremap` | insert                           |



## 操作范围

| 命令                | 操作的行                                                     |
| ------------------- | ------------------------------------------------------------ |
| `:d`                | 当前行                                                       |
| `:.d`               | 当前行                                                       |
| `:1d`               | 第一行                                                       |
| `:$d`               | 最后一行                                                     |
| `:1,$d`             | 所有行                                                       |
| `:%d`               | 所有行（这是 `1,$` 的语法糖）                                |
| `:.,5d`             | 当前行至第 5 行                                              |
| `:,5d`              | 同样是当前行至第 5 行                                        |
| `:,+3d`             | 当前行及接下来的 3 行                                        |
| `:1,+3d`            | 第一行至当前行再加 3 行                                      |
| `:,-3d`             | 当前行及向上的 3 行（Vim 会弹出提示信息，因为这是一个保留的范围） |
| `:3,'xdelete`       | 第三行至[标注](https://wsdjeg.net/vim-galore-zh-cn/#标注) 为 x 的那一行 |
| `:/^foo/,$delete`   | 当前行以下，以字符 “foo” 开头的那一行至结尾                  |
| `:/^foo/+1,$delete` | 当前行以下，以字符 “foo” 开头的那一行的下一行至结尾          |

`a,b` 基于`b` , `a;b` 基于`a` 。



## 标记

| 命令                   | 举例          | 说明                                                   |
| ---------------------- | ------------- | ------------------------------------------------------ |
| `m<markname>`          | `ma`          | 在当前位置设置名为`a`的局部标记，标记名为小写字母`a-z` |
| `m<markname>`          | `mA`          | 在当前位置设置名为`A`的局部标记，标记名为大写字母`A-Z` |
| ``<markname>`                 |``a`|反引号跳转到标记`a`的位置|
| `'<markname>`         | `'a`          | 单引号跳转到标记`a`的行首                              |
| `:marks`               |               | 列出所有标记                                           |
| `:marks <markname>`    | `:marks ab`   | 列出标记`a`和`b`                                       |
| `:delmarks <markname>` | `:delmarks a` | 删除标记`a`                                            |
| `0`-`9`                | `1`           | 进程倒数第二次结束的位置                               |



## 跳转

| 命令         | 跳转至                                         |
| ------------ | ---------------------------------------------- |
| `'[` 与 ``[` | 上一次修改或复制的第一行或第一个字符           |
| `']` 与 ``]` | 上一次修改或复制的最后一行或最后一个字符       |
| `'<` 与 ``<` | 上一次在可视模式下选取的第一行或第一个字符     |
| `'>` 与 ``>` | 上一次在可视模式下选取的最后一行或最后一个字符 |
| `''` 与 ``'` | 上一次跳转之前的光标位置                       |
| `'"` 与 ``"` | 上一次关闭当前缓冲区时的光标位置               |
| `'^` 与 ``^` | 上一次插入字符后的光标位置                     |
| `'.` 与 ``.` | 上一次修改文本后的光标位置                     |
| `'(` 与 ``(` | 当前句子的开头                                 |
| `')` 与 ``)` | 当前句子的结尾                                 |
| `'{` 与 ``{` | 当前段落的开头                                 |
| `'}` 与 ``}` | 当前段落的结尾                                 |



## 补全 

vim补全通过ctrl+x在**插入模式**下触发(以下简写为c-x)。

| 映射         | 类型                                         |
| ------------ | -------------------------------------------- |
| `<c-x><c-l>` | 整行                                         |
| `<c-x><c-n>` | 当前缓冲区中的关键字                         |
| `<c-x><c-k>` | 字典（ `:h 'dictionary'`）中的关键字         |
| `<c-x><c-t>` | 同义词字典（ `:h 'thesaurus'`）中的关键字    |
| `<c-x><c-i>` | 当前文件以及包含的文件中的关键字             |
| `<c-x><c-]>` | 标签                                         |
| `<c-x><c-f>` | 文件名                                       |
| `<c-x><c-d>` | 定义或宏定义                                 |
| `<c-x><c-v>` | Vim 命令                                     |
| `<c-x><c-u>` | 用户自定义补全（通过 `'completefunc'` 定义） |
| `<c-x><c-o>` | Omni Completion（通过 `'omnifunc'` 定义）    |
| `<c-x>s`     | 拼写建议                                     |



## 动作、操作符、文本对象

| 动作      | 说明                           |
| --------- | ------------------------------ |
| `h`       | 向左移动一个字符               |
| `j`       | 向下移动一行                   |
| `k`       | 向上移动一行                   |
| `l`       | 向右移动一个字符               |
| `0`       | 移动到行首                     |
| `$`       | 移动到行尾                     |
| `^`       | 移动到行的第一个非空白字符     |
| `w`       | 向前移动到下一个单词的开头     |
| `b`       | 向后移动到上一个单词的开头     |
| `e`       | 移动到当前单词的结尾           |
| `{`和`}`  | 分别移动到上一段和下一段的开头 |
| `(`和`)`  | 分别移动到上一句和下一句的开头 |
| `gg`      | 跳转到文件顶部                 |
| `G`       | 跳转到文件底部                 |
| `<数字>G` | 跳转到指定行号                 |

| 操作符 | 说明           |
| ------ | -------------- |
| `d`    | 删除           |
| `c`    | 更改           |
| `y`    | 复制           |
| `>`    | 增加缩进       |
| `<`    | 减少缩进       |
| `g~`   | 改变大小写     |
| `=`    | 自动格式化代码 |

| 文本对象   | 说明                                          |
| ---------- | --------------------------------------------- |
| `iw`或`aw` | 内部单词（不含标点符号）或 包含标点符号的单词 |
| `is`或`as` | 内部句子 或 包含标点符号的句子                |
| `ip`或`ap` | 内部段落 或 包含空白行的段落                  |
| `i(`或`a(` | 内部圆括号 或 包含圆括号本身                  |
| `i[`或`a[` | 内部方括号 或 包含方括号本身                  |
| `i{`或`a{` | 内部花括号 或 包含花括号本身                  |
| `it`或`at` | html/xml标签内的文本或包含标签本身            |

**动作、操作符、文本对象可组合使用，可搭配数字使用。**



## 自动命令

自动命令的基本语法
`:autocmd [group] {events} {filepattern} [nested] {command}`
`group`：可选参数，用于将多个自动命令组织在一起。
`events`：触发自动命令的事件，可以是多个事件用逗号分隔。
`filepattern`：匹配文件名模式，例如 `*.txt` 匹配所有文本文件。
`command`：当事件触发时要执行的命令。

`:h {event}`查看Vim中所有事件列表



## 跳转历史，变更历史

| 跳转命令          | 说明             |
| ----------------- | ---------------- |
| `ctrl-o`          | 跳转到上一个位置 |
| `ctrl-i` 或 `Tab` | 跳转到下一个位置 |
| `:jumps`          | 显示跳转列表     |
| `:clearjumps`     | 清除跳转列表     |

| 变更命令                           | 说明                                                         |
| ---------------------------------- | ------------------------------------------------------------ |
| `[count]u` 或 `:undo [count]`      | 撤销count次更改                                              |
| `ctrl-r`                           | 重复被撤销的操作                                             |
| `U`                                | 撤销上一次更改                                               |
| `g;`                               | 跳转到上一个变更位置                                         |
| `g,`                               | 跳转到下一个变更位置                                         |
| `[count]g-` 或 `:earlier [count]?` | 根据时间回退到 `[count]` 次改动之前。”?” 为 “s”、”m”、”h”、”d” 或 “f”之一。例如，`:earlier 2d` 会回退到两天之前。`:earlier 1f` 则会回退到最近一次文件保存时的内容 |
| `[count]g+` 或 `:later [count]?`   | 类似 `g-`，但方向相反                                        |
| `:changes`                         | 显示变更历史                                                 |



## 位置信息表

| 动作         | 全局位置信息表 | 局部位置信息表 |
| ------------ | -------------- | -------------- |
| 打开窗口     | `:copen`       | `:lopen`       |
| 关闭窗口     | `:cclose`      | `:lclose`      |
| 下一个条目   | `:cnext`       | `:lnext`       |
| 上一个条目   | `:cprevious`   | `:lprevious`   |
| 第一个条目   | `:cfirst`      | `:lfirst`      |
| 最后一个条目 | `:clast`       | `:llast`       |



## 宏

**录制宏：**开始录制(`q`) --> 保存至某个寄存器(e.g.`a`) --> 执行想录制的操作 --> 结束录制(`q`)

**播放宏：**`@<寄存器名称>`(e.g. `@a`播放寄存器`a`中的宏1次)

​		`<number>@<寄存器名称>`(e.g. `5@a`播放寄存器`a`中的宏5次)

**查看宏：**`:registers`查看当前所有寄存器

​		`:echo @<寄存器名称>`查看某个寄存器(e.g.`echo @a`查看寄存器`a`)

**编辑宏：**`:let @<寄存器名称> = "新宏内容"`



## 折叠

| 折叠方式 | 说明                                       |      |
| -------- | ------------------------------------------ | ---- |
| diff     | 在「比较窗口」中折叠未改变的文本           |      |
| expr     | 使用 `'foldexpr'` 来创建新的折叠逻辑       |      |
| indent   | 基于缩进折叠                               |      |
| manual   | 使用 `zf`、`zF` 或 `:fold` 来自定义折叠    |      |
| marker   | 根据特定的文本标记折叠（通常用于代码注释） |      |
| syntax   | 根据语法折叠，比如折叠 `if` 代码块         |      |

| 折叠命令     | 说明                                 |
| ------------ | ------------------------------------ |
| `zo` 或 `zm` | 打开当前折叠                         |
| `zc` 或 `zM` | 关闭当前折叠                         |
| `zR`         | 完全展开所有的折叠                   |
| `zM`         | 完全折叠所有的折叠                   |
| `zj`         | 移动到下一个折叠                     |
| `zk`         | 移动到上一个折叠                     |
| `zd`         | 删除当前折叠                         |
| `zE`         | 删除所有的折叠                       |
| `zx`         | 根据当前的 `foldmethod` 重新计算折叠 |



## 会话

| 会话命令                                          | 示例                                                         | 说明                          |
| ------------------------------------------------- | ------------------------------------------------------------ | ----------------------------- |
| `:mksession! (<路径>/)<文件名>`                   | `:mksession! ~/.vim/sessions/my_session.vim`                 | 将会话保存至:`my_session.vim` |
| `autocmd VimLeave * mksession! (<路径>/)<文件名>` | `autocmd VimLeave * mksession! ~/.vim/sessions/last_session.vim` | 在`.vimrc`中添加配置          |
| `vim -S (<路径>/)<文件名>` 或 `:source <文件名>`  | `vim -S ~/.vim/sessions/my_session.vim`                      | 恢复会话                      |
| `:vs <文件名>`                                    | `:vs Foo.vim`                                                | 查看会话                      |



## 局部化

| 全局        | 局部                  | 作用域       | 帮助文档              |
| ----------- | --------------------- | ------------ | --------------------- |
| `:set`      | `:setlocal`           | 缓冲区或窗口 | `:h local-options`    |
| `:map`      | `:map <buffer>`       | 缓冲区       | `:h :map-local`       |
| `:autocmd`  | `:autocmd * <buffer>` | 缓冲区       | `:h autocmd-buflocal` |
| `:cd`       | `:lcd`                | 窗口         | `:h :lcd`             |
| `:<leader>` | `:<localleader>`      | 缓冲区       | `:h maploacalleader`  |



## 帮助

`:h`

- 用单引号把文本包起来表示选项，如：`:h 'textwidth'`
- 以小括号结尾表示 VimL 函数，如：`:h reverse()`
- 以英文冒号开头表示命令，如：`:h :echo`



## 剪切板

| 操作   | 说明                         |
| ------ | ---------------------------- |
| `"+y`  | 将选中的文本复制到系统剪切板 |
| `"+yy` | 将整行复制到系统剪切板       |
| `"+d`  | 将选中的文本剪切到系统剪切板 |
| `"+dd` | 将整行剪切到系统剪切板       |
| `"+p`  | 从系统剪切板粘贴文本         |
| `"*p`  | 贴粘 PRIMARY 选择中的内容    |



## 技巧

- 在使用 `v` 或者 `V` 选择某段文字后，可以用 `o` 或者 `O` 按键跳至选择区域的开头或者结尾：`:h v_o`,`:h v_O`

- `Ctrl + l`：清空并重新绘制当前屏幕

- 快速移动当前行

  `nnoremap [e  :<c-u>execute 'move -1-'. v:count1<cr>`
  `nnoremap ]e  :<c-u>execute 'move +'. v:count1<cr>`

  可以搭配数字使用，比如连续按下 2 ] e 就可以把当前行向下移动两行

- 快速添加空行

  ```
  nnoremap [<space>  :<c-u>put! =repeat(nr2char(10), v:count1)<cr>'[
  nnoremap ]<space>  :<c-u>put =repeat(nr2char(10), v:count1)<cr>
  ```

  连续按下 `<number> \[ <space>` 在当前行上方插入 n 个空行,n=<number>。

  

